<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Win</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      padding: 10px;
      background-color: #f8f9fa;
      border-bottom: 1px solid #ddd;
      gap: 10px;
    }

    .controls input,
    .controls button {
      padding: 8px 12px;
      font-size: 1.2vh;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .controls button {
      background-color: #007BFF;
      color: #fff;
      cursor: pointer;
    }

    .controls button:hover {
      background-color: #0056b3;
    }

    .results-container {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: center;
      overflow-y: auto;
      padding: 10px;
      flex: 1;
      gap: 20px;
    }

    .results {
      display: grid;
      grid-template-columns: auto 1fr 1fr;
      gap: 0;
      padding: 0;
      flex: 1 1 auto;
      max-width: 300px;
      min-width: 250px;
    }

    .letter,
    .category,
    .answer {
      padding: 8px;
      border: 1px solid #ccc;
      font-size: 1.8vh;
      display: flex;
      align-items: center;
    }

    .letter {
      background-color: #ddd;
      font-weight: bold;
      text-align: center;
      color: #333;
    }

    .category {
      font-weight: bold;
      text-align: left !important;
    }

    .answer {
      text-align: left !important;
      color: #555;
    }

    @media (max-width: 600px) {
      .letter, .category, .answer {
        font-size: 1.5vh;
      }
    }
  </style>
</head>
<body>
  <div class="controls">
    <input type="text" id="letterInput" maxlength="1" placeholder="Enter letter (A-Z)*" autofocus />
    <button id="changeLetterButton" style="display: none;">Change Letter</button>
    <input type="text" id="categoryInput" placeholder="Search category" style="display: none;" />
  </div>
  <div class="results-container" id="resultsContainer"></div>

  <script src="topics.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const letterInput = document.getElementById("letterInput");
      const changeLetterButton = document.getElementById("changeLetterButton");
      const categoryInput = document.getElementById("categoryInput");
      const resultsContainer = document.getElementById("resultsContainer");

      let lastTypedTime = 0;

      function alphabetizeData(data) {
        const sortedData = {};
        Object.keys(data)
          .sort()
          .forEach(letter => {
            sortedData[letter] = {};
            Object.keys(data[letter])
              .sort()
              .forEach(category => {
                sortedData[letter][category] = data[letter][category];
              });
          });
        return sortedData;
      }

      const sortedData = alphabetizeData(data);

      function displayResults(letter, categoryFilter = "") {
        resultsContainer.innerHTML = "";

        const filteredData = {};
        if (sortedData[letter]) {
          for (const category of Object.keys(sortedData[letter])) {
            if (!categoryFilter || category.toLowerCase().includes(categoryFilter.toLowerCase())) {
              filteredData[category] = sortedData[letter][category];
            }
          }
        }

        const sortedCategories = Object.keys(filteredData);
        if (sortedCategories.length === 0) {
          resultsContainer.innerHTML = "<p>No results found.</p>";
          return;
        }

        // Estimate number of rows per column based on screen height
        const screenHeight = window.innerHeight;
        const rowHeight = 50; // approximate cell height
        const maxRowsPerCol = Math.floor((screenHeight - 100) / rowHeight); // minus header
        const columns = Math.ceil(sortedCategories.length / maxRowsPerCol);

        const rowsPerColumn = Math.ceil(sortedCategories.length / columns);
        let lastLetter = "";

        for (let i = 0; i < columns; i++) {
          const gridDiv = document.createElement("div");
          gridDiv.className = "results";

          sortedCategories
            .slice(i * rowsPerColumn, (i + 1) * rowsPerColumn)
            .forEach(category => {
              const currentLetter = category[0].toUpperCase();
              const letterDiv = document.createElement("div");
              letterDiv.className = "letter";

              if (currentLetter !== lastLetter) {
                letterDiv.textContent = currentLetter;
              } else {
                letterDiv.textContent = " ";
              }

              lastLetter = currentLetter;

              const categoryDiv = document.createElement("div");
              categoryDiv.className = "category";
              categoryDiv.textContent = category;

              const answerDiv = document.createElement("div");
              answerDiv.className = "answer";
              answerDiv.textContent = filteredData[category][0] || "N/A";

              gridDiv.appendChild(letterDiv);
              gridDiv.appendChild(categoryDiv);
              gridDiv.appendChild(answerDiv);
            });

          resultsContainer.appendChild(gridDiv);
        }
      }

      letterInput.addEventListener("input", () => {
        const letter = letterInput.value.toUpperCase();
        if (letter) {
          displayResults(letter);
          categoryInput.style.display = "inline-block";
          categoryInput.focus();
          letterInput.style.display = "none";
          changeLetterButton.style.display = "inline-block";
        }
      });

      categoryInput.addEventListener("keydown", (event) => {
        const currentTime = Date.now();

        if (!/^[a-zA-Z0-9]$/.test(event.key) && event.key !== "Backspace" && event.key !== " ") {
          return;
        }

        if (event.key === " " || event.key === "Backspace") {
          categoryInput.value = "";
          displayResults(letterInput.value.toUpperCase(), "");
          event.preventDefault();
          return;
        }

        if (currentTime - lastTypedTime > 1000) {
          const letter = event.key.toUpperCase();
          categoryInput.value = letter;
          displayResults(letterInput.value.toUpperCase(), letter);
          event.preventDefault();
        } else {
          setTimeout(() => {
            displayResults(letterInput.value.toUpperCase(), categoryInput.value);
          }, 0);
        }

        lastTypedTime = currentTime;
      });

      changeLetterButton.addEventListener("click", () => {
        letterInput.value = "";
        categoryInput.value = "";
        resultsContainer.innerHTML = "";
        categoryInput.style.display = "none";
        letterInput.style.display = "inline-block";
        changeLetterButton.style.display = "none";
        letterInput.focus();
      });

      function adjustResultsHeight() {
        const controlsHeight = document.querySelector(".controls").offsetHeight;
        const viewportHeight = window.innerHeight;
        resultsContainer.style.height = `${viewportHeight - controlsHeight}px`;
      }

      window.addEventListener("resize", adjustResultsHeight);
      adjustResultsHeight();
    });
  </script>
</body>
</html>
